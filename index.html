 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MASOLITES ECOMAS</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/main.css">
    <style>
        /* Additional styles */
        .bank-details p {
            margin: 5px 0;
            font-size: 0.8rem;
        }
        
        .receipt-datetime {
            display: flex;
            gap: 10px;
        }
        
        .receipt-datetime input {
            flex: 1;
        }
        
        .admin-link {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 0.7rem;
            color: var(--lemon-green);
        }
        
        .logout-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <a href="admin.html" class="admin-link">Admin Login</a>
        
        <div class="top-section">
            <header>
                <h1 class="logo">MASOLITES ECOMAS</h1>
                <p class="tagline">Building Trust & A Better Society Together</p>
                <div class="auth-buttons">
                    <button class="btn btn-login" id="loginBtn">Login</button>
                    <button class="btn btn-register" id="registerBtn">Register</button>
                    <button class="logout-btn" id="logoutBtn" style="display:none;">Logout</button>
                </div>
                <div id="walletInfo" style="display:none; font-size:0.7rem; margin-top:5px; color: var(--lemon-green);">
                    Connected: <span id="walletAddress"></span>
                    <span class="platform-wallet-indicator">Platform Wallet</span>
                </div>
                <div id="memberBadge" class="member-badge">üéÅ Free Member | <span id="memberId">MSL-F-000000</span></div>
            </header>
            
            <!-- ... (rest of your HTML remains the same) ... -->
        </div>
    </div>

    <!-- ... (modals remain mostly the same) ... -->

    <!-- Updated Save & Earn Modal -->
    <div class="modal" id="saveEarnModal">
        <div class="modal-content">
            <h3>Save & Earn</h3>
            
            <div class="tabs">
                <button class="tab-btn active" data-tab="manual">Manual Transfer</button>
                <button class="tab-btn" data-tab="flutterwave">Flutterwave</button>
                <button class="tab-btn" data-tab="crypto">Crypto Vesting</button>
            </div>
            
            <!-- Manual Transfer Tab -->
            <div class="tab-content active" id="manualTab">
                <div class="bank-details">
                    <h4>Pay To Bank:</h4>
                    <p><strong>UBA</strong>: 1026664654</p>
                    <p><strong>Account Name</strong>: Masses Freedom</p>
                </div>
                
                <div class="deposit-form">
                    <label>Amount (‚Ç¶):</label>
                    <input type="number" id="depositAmount" min="500" max="2000000" value="1000">
                    
                    <label>Receipt Date & Time:</label>
                    <div class="receipt-datetime">
                        <input type="text" id="receiptDate" placeholder="dd.mm.yy">
                        <input type="text" id="receiptTime" placeholder="hh.mm am/pm">
                    </div>
                    
                    <button class="cta-button" id="submitDeposit">Submit Deposit</button>
                    <p class="note">Minimum: ‚Ç¶500, Maximum: ‚Ç¶2,000,000</p>
                </div>
            </div>
            
            <!-- Flutterwave Tab -->
            <div class="tab-content" id="flutterwaveTab">
                <div class="flutterwave-form">
                    <label>Flutterwave API Key:</label>
                    <input type="text" id="flutterwaveKey" placeholder="Enter your API Key">
                    
                    <label>Amount (‚Ç¶):</label>
                    <input type="number" id="fwAmount" min="500" value="1000">
                    
                    <button class="cta-button" id="processFlutterwave">Pay with Flutterwave</button>
                </div>
            </div>
            
            <!-- ... (rest of modals) ... -->
        </div>
    </div>

    <script>
        // ... (inside the DOMContentLoaded event listener) ...

        // 3. Fix Buy MAZOL button
        document.getElementById('buyButton').addEventListener('click', function() {
            document.getElementById('currencyModal').style.display = 'flex';
        });

        // 5. Generate proper crypto address (42 characters)
        function generateCryptoAddress() {
            const chars = '0123456789ABCDEF';
            let address = '0x';
            for (let i = 0; i < 40; i++) {
                address += chars[Math.floor(Math.random() * 16)];
            }
            return address;
        }

        // 8. MetaMask wallet connection
        async function connectMetaMask() {
            if (typeof window.ethereum === 'undefined') {
                alert('Please install MetaMask!');
                return;
            }
            
            try {
                const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                const walletAddress = accounts[0];
                
                // Display connected address
                document.getElementById('walletAddress').textContent = 
                    walletAddress.substring(0, 6) + '...' + walletAddress.substring(walletAddress.length - 4);
                document.getElementById('walletInfo').style.display = 'block';
                
                return walletAddress;
            } catch (error) {
                console.error("MetaMask connection failed:", error);
                alert('Wallet connection failed: ' + error.message);
            }
        }

        // 9. MLM System
        class MLMSystem {
            static processReferral(referrerId, newUserId, amount) {
                const users = JSON.parse(localStorage.getItem('users') || []);
                const referrer = users.find(u => u.memberId === referrerId);
                
                if (referrer) {
                    // 2.5% referral commission
                    const commission = amount * 0.025;
                    referrer.cryptoWallet.balance += commission;
                    
                    // Update user
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    // Add notification
                    const message = `You earned ${commission.toFixed(6)} MZLx from referral!`;
                    UserSystem.addNotification(referrer, message);
                }
            }
        }

        // 10. Fix Voting System
        document.getElementById('submitVote').addEventListener('click', function() {
            const user = UserSystem.getCurrentUser();
            if (!user) {
                alert('Please login to vote');
                return;
            }
            
            // Check if user has tokens
            if (user.cryptoWallet.balance < 25) {
                alert('You need at least 25 MZLx to vote');
                return;
            }
            
            const proposedPrice = parseFloat(document.getElementById('priceSlider').value);
            
            // Save vote
            const votes = JSON.parse(localStorage.getItem('votes') || []);
            votes.push({
                userId: user.email,
                price: proposedPrice,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('votes', JSON.stringify(votes));
            
            alert(`Vote submitted for $${proposedPrice.toFixed(4)} per MZLx!`);
            document.getElementById('votingModal').style.display = 'none';
        });

        // 6. Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
            UserSystem.logout();
            location.reload();
        });

        // 4. Admin Panel (admin.html) will be created separately
        // 7. Flutterwave integration
        document.getElementById('processFlutterwave').addEventListener('click', function() {
            const apiKey = document.getElementById('flutterwaveKey').value;
            const amount = document.getElementById('fwAmount').value;
            
            if (!apiKey) {
                alert('Please enter your Flutterwave API Key');
                return;
            }
            
            // In a real implementation, this would call Flutterwave API
            alert(`Processing ‚Ç¶${amount} payment via Flutterwave...`);
        });

        // Initialize MetaMask connection button
        document.getElementById('platformWalletBtn').addEventListener('click', async function() {
            const address = await connectMetaMask();
            if (address) {
                const user = UserSystem.getCurrentUser();
                if (user) {
                    user.metaMaskAddress = address;
                    localStorage.setItem('currentUser', JSON.stringify(user));
                }
            }
        });

        // ... (rest of your script) ...
    </script>
</body>
</html>
